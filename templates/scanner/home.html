{% extends 'scanner/base.html' %}
{% load static %}

{% block content %}
{% load adsense_tags %}
<!-- Ztion AdSense Unit -->
{% ztion_ad %}
<!-- Hero Section -->
<section class="hero-section bg-gradient-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center min-vh-75">
            <div class="col-lg-6">
                <div class="hero-content">
                    <h1 class="display-3 fw-bold mb-4 animate-fade-in d-flex align-items-center">
                        <img src="{% static 'images/ztionsec_logo.svg' %}?v=3" alt="ZtionSec Logo" class="hero-logo me-3">
                        Sec
                    </h1>
                    <p class="lead mb-4 fs-5">
                        Professional security analysis platform providing comprehensive vulnerability assessment, 
                        penetration testing, and threat intelligence for modern web applications.
                    </p>
                    <div class="hero-stats mb-4">
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="stat-item animate-delay-1" style="opacity: 0;">
                                    <div class="stat-number">
                                        <h3 class="text-warning mb-1 counter" data-target="{{ total_scans|default:"1247" }}">0</h3>
                                        <small>Scans Completed</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-item animate-delay-2" style="opacity: 0;">
                                    <div class="stat-number">
                                        <h3 class="text-warning mb-1 counter" data-target="{{ total_vulnerabilities|default:"3891" }}">0</h3>
                                        <small>Vulnerabilities Found</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="stat-item animate-delay-3" style="opacity: 0;">
                                    <div class="stat-number">
                                        <h3 class="text-warning mb-1">99.9%</h3>
                                        <small>Uptime</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex gap-3 flex-wrap">
                        <a href="#scanner" class="btn btn-warning btn-lg px-4">
                            <i class="fas fa-shield-alt me-2"></i> Start Security Scan
                        </a>
                        <a href="{% url 'advanced_dashboard' %}" class="btn btn-outline-light btn-lg px-4">
                            <i class="fas fa-microscope me-2"></i> Advanced Tools
                        </a>
                        <a href="{% url 'budget_scanner' %}" class="btn btn-outline-light btn-lg px-4">
                            <i class="fas fa-dollar-sign me-2"></i> Budget Scanner
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="hero-visual text-center">
                    <div class="security-dashboard-preview">
                        <div class="dashboard-mockup bg-white rounded-3 shadow-lg p-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="text-dark mb-0">Security Dashboard</h6>
                                <span class="badge bg-success">Live</span>
                            </div>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="metric-card bg-primary text-white p-2 rounded">
                                        <small>SSL Score</small>
                                        <div class="h5 mb-0">A+</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-card bg-success text-white p-2 rounded">
                                        <small>Security</small>
                                        <div class="h5 mb-0">95%</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-card bg-warning text-white p-2 rounded">
                                        <small>Performance</small>
                                        <div class="h5 mb-0">87%</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-card bg-info text-white p-2 rounded">
                                        <small>Headers</small>
                                        <div class="h5 mb-0">8/10</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Security Analysis Features -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 class="display-5 fw-bold animate-fade-in" style="opacity: 0;">Security Analysis Features</h2>
                <p class="lead text-muted animate-fade-in animate-delay-1" style="opacity: 0;">Comprehensive security testing in one powerful tool</p>
                <div class="feature-divider mx-auto animate-delay-2" style="width: 60px; height: 4px; background: var(--primary-gradient); border-radius: 2px; opacity: 0;"></div>
            </div>
        </div>
        
        <div class="row g-4">
            <div class="col-md-4 text-center">
                <div class="card h-100 security-card">
                    <div class="card-body">
                        <i class="fas fa-certificate feature-icon"></i>
                        <h5 class="card-title">SSL Certificate Analysis</h5>
                        <p class="card-text">Check SSL validity, issuer information, expiry dates, and security grades.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 text-center">
                <div class="card h-100 security-card">
                    <div class="card-body">
                        <i class="fas fa-shield-alt feature-icon"></i>
                        <h5 class="card-title">Security Headers</h5>
                        <p class="card-text">Analyze HTTP security headers including HSTS, CSP, X-Frame-Options, and more.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 text-center">
                <div class="card h-100 security-card">
                    <div class="card-body">
                        <i class="fas fa-cogs feature-icon"></i>
                        <h5 class="card-title">CMS Detection</h5>
                        <p class="card-text">Identify content management systems and their versions for security assessment.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 text-center">
                <div class="card h-100 security-card">
                    <div class="card-body">
                        <i class="fas fa-tachometer-alt feature-icon"></i>
                        <h5 class="card-title">Performance Metrics</h5>
                        <p class="card-text">Monitor response times, status codes, and server information.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 text-center">
                <div class="card h-100 security-card">
                    <div class="card-body">
                        <i class="fas fa-file-pdf feature-icon"></i>
                        <h5 class="card-title">PDF Reports</h5>
                        <p class="card-text">Generate comprehensive security reports in PDF format for documentation.</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 text-center">
                <div class="card h-100 security-card">
                    <div class="card-body">
                        <i class="fas fa-chart-line feature-icon"></i>
                        <h5 class="card-title">Security Analytics</h5>
                        <p class="card-text">Advanced security metrics and trend analysis for comprehensive insights.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Website Scanner Section -->
<section id="website-scanner" class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-globe"></i> Website Security Scanner
                        </h4>
                    </div>
                    <div class="card-body">
                        <form method="post" action="{% url 'scan_website' %}" id="websiteScanForm" novalidate>
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="url" class="form-label">Website URL *</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <input type="url" class="form-control" id="url" name="url" 
                                           placeholder="https://example.com" required
                                           pattern="https?://.+" 
                                           title="Please enter a valid URL starting with http:// or https://">
                                    <div class="invalid-feedback">
                                        Please enter a valid URL (e.g., https://example.com)
                                    </div>
                                </div>
                                <div class="form-text">
                                    Enter the complete URL including protocol (http:// or https://)
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Scan Options</label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="checkSSL" name="check_ssl" checked>
                                            <label class="form-check-label" for="checkSSL">
                                                SSL Certificate Analysis
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="checkHeaders" name="check_headers" checked>
                                            <label class="form-check-label" for="checkHeaders">
                                                Security Headers Check
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="checkCMS" name="check_cms" checked>
                                            <label class="form-check-label" for="checkCMS">
                                                CMS Detection
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="checkPerformance" name="check_performance" checked>
                                            <label class="form-check-label" for="checkPerformance">
                                                Performance Analysis
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-lg w-100" id="scanButton">
                                <i class="fas fa-search"></i> Start Security Scan
                            </button>
                        </form>
                    </div>
                    
                    <!-- Ztion In-Article AdSense -->
                    <div class="adsense-in-article mt-4">
                        <ins class="adsbygoogle"
                             style="display:block; text-align:center;"
                             data-ad-layout="in-article"
                             data-ad-format="fluid"
                             data-ad-client="ca-pub-9693358517951567"
                             data-ad-slot="6305965263"></ins>
                        <script>
                             (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar with AdSense -->
            <div class="col-lg-4">
                <div class="sticky-top" style="top: 20px;">
                    <!-- Quick Stats Card -->
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="fas fa-chart-bar"></i> Live Security Stats</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small">Scans Today</span>
                                <span class="badge bg-primary">{{ scans_today|default:"47" }}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small">Threats Blocked</span>
                                <span class="badge bg-danger">{{ threats_blocked|default:"1,234" }}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small">SSL Issues Found</span>
                                <span class="badge bg-warning">{{ ssl_issues|default:"89" }}</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small">Security Score Avg</span>
                                <span class="badge bg-success">{{ avg_security_score|default:"87%" }}</span>
                            </div>
                            <hr>
                            <div class="text-center">
                                <a href="{% url 'security_analytics' %}" class="btn btn-sm btn-info w-100">
                                    <i class="fas fa-chart-line"></i> View Analytics
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ztion Sidebar AdSense -->
                    <div class="adsense-sidebar mb-4">
                        <ins class="adsbygoogle"
                             style="display:inline-block;width:300px;height:250px"
                             data-ad-client="ca-pub-9693358517951567"
                             data-ad-slot="6305965263"></ins>
                        <script>
                             (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    
                    <!-- Security Tips Card -->
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="fas fa-lightbulb"></i> Security Tips</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="fas fa-check text-success"></i> Use HTTPS everywhere</li>
                                <li class="mb-2"><i class="fas fa-check text-success"></i> Keep software updated</li>
                                <li class="mb-2"><i class="fas fa-check text-success"></i> Enable security headers</li>
                                <li class="mb-2"><i class="fas fa-check text-success"></i> Regular security scans</li>
                                <li class="mb-2"><i class="fas fa-check text-success"></i> Strong passwords</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Breach Checker Section -->

<!-- Recent Scans Section -->
{% if recent_scans %}
<section class="py-5 bg-light">
    <div class="container">
        <h3 class="mb-4">
            <i class="fas fa-history"></i> Recent Security Scans
        </h3>
        <div class="row">
            {% for scan in recent_scans %}
            <div class="col-md-6 col-lg-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="security-grade grade-{{ scan.grade }}">{{ scan.grade }}</span>
                            <small class="text-muted">{{ scan.scan_date|date:"M d, Y" }}</small>
                        </div>
                        <h6 class="card-title">{{ scan.url|truncatechars:30 }}</h6>
                        <p class="card-text">
                            <small class="text-muted">
                                Score: {{ scan.security_score }}/100
                            </small>
                        </p>
                        <a href="{% url 'generate_report' scan.id %}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-download"></i> Download Report
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center">
            <a href="{% url 'scan_history' %}" class="btn btn-primary">
                <i class="fas fa-list"></i> View All Scans
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Ztion Footer AdSense Banner -->
<div class="adsense-banner-footer">
    <ins class="adsbygoogle"
         style="display:inline-block;width:728px;height:90px"
         data-ad-client="ca-pub-9693358517951567"
         data-ad-slot="6305965263"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

{% endblock %}

{% block extra_css %}
<style>
/* Professional Home Page Styling */
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.min-vh-75 {
    min-height: 75vh;
}

.hero-content {
    animation: fadeInUp 1s ease-out;
}

.hero-visual {
    animation: fadeInRight 1s ease-out 0.3s both;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.stat-item h3 {
    font-size: 2rem;
    font-weight: 700;
}

.dashboard-mockup {
    transform: perspective(1000px) rotateY(-15deg) rotateX(5deg);
    transition: transform 0.3s ease;
}

.dashboard-mockup:hover {
    transform: perspective(1000px) rotateY(-10deg) rotateX(2deg);
}

.metric-card {
    transition: all 0.3s ease;
}

.metric-card:hover {
    transform: translateY(-2px);
}

.security-card {
    transition: all 0.3s ease;
    border: none;
}

.security-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
}

.feature-icon {
    font-size: 3rem;
    color: #007bff;
    margin-bottom: 1rem;
}

.form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.btn {
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
}

.card {
    border: none;
    transition: all 0.3s ease;
}

.card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

/* Remove any potential blank spaces */
body {
    margin: 0;
    padding: 0;
}

section {
    margin: 0;
}

.container-fluid {
    padding: 0;
}

/* Ensure full width coverage */
.hero-section {
    width: 100%;
    margin: 0;
}

/* Professional spacing */
.py-5 {
    padding-top: 4rem !important;
    padding-bottom: 4rem !important;
}

/* Form validation styles */
.was-validated .form-control:valid {
    border-color: #28a745;
}

.was-validated .form-control:invalid {
    border-color: #dc3545;
}

.loading-spinner {
    display: none;
}

.loading .loading-spinner {
    display: inline-block;
}

.loading .btn-text {
    display: none;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Professional Form Validation System
document.addEventListener('DOMContentLoaded', function() {
    // Website Scanner Form Validation
    const websiteForm = document.getElementById('websiteScanForm');
    const urlInput = document.getElementById('url');
    const scanButton = document.getElementById('scanButton');
    
    // Additional form validation can be added here
    
    // Real-time URL validation
    urlInput.addEventListener('input', function() {
        validateURL(this);
    });
    
    // Additional validation can be added here
    
    // Website scanner form submission
    websiteForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validateURL(urlInput)) {
            // Check if at least one scan option is selected
            const scanOptions = document.querySelectorAll('input[name^="check_"]:checked');
            if (scanOptions.length === 0) {
                showError('Scan Options Required', 'Please select at least one scan option to proceed.');
                return;
            }
            
            // Show loading state
            showLoadingState(scanButton, 'Initiating Security Scan...');
            
            // Submit form after validation
            setTimeout(() => {
                this.submit();
            }, 1000);
        } else {
            websiteForm.classList.add('was-validated');
        }
    });
    
    // Additional form handlers can be added here
});

// URL Validation Function
function validateURL(input) {
    const urlPattern = /^https?:\/\/.+/;
    const value = input.value.trim();
    
    if (!value) {
        setFieldError(input, 'URL is required');
        return false;
    }
    
    if (!urlPattern.test(value)) {
        setFieldError(input, 'Please enter a valid URL starting with http:// or https://');
        return false;
    }
    
    // Check for common URL issues
    if (value.includes(' ')) {
        setFieldError(input, 'URL cannot contain spaces');
        return false;
    }
    
    if (!value.includes('.')) {
        setFieldError(input, 'Please enter a valid domain name');
        return false;
    }
    
    setFieldValid(input);
    return true;
}


// Set field error state
function setFieldError(input, message) {
    input.classList.add('is-invalid');
    input.classList.remove('is-valid');
    
    const feedback = input.parentNode.querySelector('.invalid-feedback');
    if (feedback) {
        feedback.textContent = message;
    }
}

// Set field valid state
function setFieldValid(input) {
    input.classList.add('is-valid');
    input.classList.remove('is-invalid');
}

// Show loading state for buttons
function showLoadingState(button, message) {
    const originalHTML = button.innerHTML;
    button.innerHTML = `
        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
        ${message}
    `;
    button.disabled = true;
    
    // Reset button after 10 seconds (fallback)
    setTimeout(() => {
        button.innerHTML = originalHTML;
        button.disabled = false;
    }, 10000);
}

// Manual refresh function (no auto-refresh)
function manualRefresh() {
    showLoading('Refreshing Data', 'Updating security statistics...');
    
    // Simulate data refresh
    setTimeout(() => {
        location.reload();
    }, 2000);
}

// Add manual refresh button to stats card
document.addEventListener('DOMContentLoaded', function() {
    const statsCard = document.querySelector('.card-header:has(.fa-chart-bar)');
    if (statsCard) {
        const refreshBtn = document.createElement('button');
        refreshBtn.className = 'btn btn-sm btn-outline-light ms-2';
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
        refreshBtn.title = 'Refresh Statistics';
        refreshBtn.onclick = manualRefresh;
        statsCard.appendChild(refreshBtn);
    }
});

// Counter Animation
function animateCounters() {
    const counters = document.querySelectorAll('.counter');
    counters.forEach(counter => {
        const target = parseInt(counter.getAttribute('data-target'));
        const increment = target / 100;
        let current = 0;
        
        const updateCounter = () => {
            if (current < target) {
                current += increment;
                counter.textContent = Math.floor(current).toLocaleString();
                requestAnimationFrame(updateCounter);
            } else {
                counter.textContent = target.toLocaleString();
            }
        };
        
        updateCounter();
    });
}

// Enhanced animations for home page
document.addEventListener('DOMContentLoaded', function() {
    // Trigger counter animation when stats come into view
    const statsObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateCounters();
                statsObserver.unobserve(entry.target);
            }
        });
    });
    
    const heroStats = document.querySelector('.hero-stats');
    if (heroStats) {
        statsObserver.observe(heroStats);
    }
    
    // Real scan functionality
    const scanButton = document.querySelector('a[href="#website-scanner"]');
    if (scanButton) {
        scanButton.addEventListener('click', function(e) {
            e.preventDefault();
            // Scroll to the website scanner section
            const scannerSection = document.getElementById('website-scanner');
            if (scannerSection) {
                scannerSection.scrollIntoView({ behavior: 'smooth' });
            }
        });
    }
    
    // Handle scan form submission
    const scanForm = document.getElementById('scanForm');
    if (scanForm) {
        scanForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const urlInput = document.getElementById('url');
            const url = urlInput.value.trim();
            
            if (!url) {
                showToast('Please enter a website URL', 'error');
                return;
            }
            
            if (!validateUrl(urlInput)) {
                return;
            }
            
            // Start real scan
            startSecurityScan(url);
        });
    }
    
    // Real security scan function
    function startSecurityScan(url) {
        showModernPopup(
            'Security Scan in Progress',
            `
            <div class="text-center">
                <div class="loading-spinner mx-auto mb-3"></div>
                <p>Scanning <strong>${url}</strong></p>
                <div class="progress mb-3">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                         style="width: 0%; background: var(--primary-gradient);" 
                         id="scan-progress"></div>
                </div>
                <small class="text-muted">Analyzing SSL, headers, and security configurations...</small>
            </div>
            `
        );
        
        // Submit to backend for real scanning
        fetch('/api/scan/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({ url: url })
        })
        .then(response => response.json())
        .then(data => {
            closeModernPopup();
            if (data.success) {
                showToast('Security scan completed successfully!', 'success');
                // Redirect to results or show results
                window.location.href = '/scan-history/';
            } else {
                showToast('Scan failed: ' + (data.error || 'Unknown error'), 'error');
            }
        })
        .catch(error => {
            closeModernPopup();
            showToast('Network error during scan', 'error');
        });
    }
});

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});

// Add form interaction analytics
function trackFormInteraction(formType, action) {
    console.log(`Form Interaction: ${formType} - ${action}`);
    // In production, this would send to analytics service
}

// Track form focus events
document.getElementById('url')?.addEventListener('focus', () => trackFormInteraction('website-scan', 'url-focus'));
</script>
{% endblock %}
