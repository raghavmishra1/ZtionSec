{% extends 'scanner/base.html' %}

{% block title %}Security Scan Results - ZtionSec{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center">
                    <h1 class="display-4 mb-3">
                        <i class="fas fa-shield-alt"></i> Security Analysis Results
                    </h1>
                    <h3 class="mb-3">{{ scan.url }}</h3>
                    <div class="d-flex justify-content-center align-items-center gap-4">
                        <div class="text-center">
                            <div class="security-grade grade-{{ scan.grade }}">{{ scan.grade }}</div>
                            <p class="mt-2 mb-0">Security Grade</p>
                        </div>
                        <div class="text-center">
                            <h2 class="display-6 mb-0">{{ scan.security_score }}/100</h2>
                            <p class="mt-2 mb-0">Security Score</p>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="{% url 'generate_report' scan.id %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-download"></i> Download PDF Report
                        </a>
                        <a href="{% url 'home' %}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-arrow-left"></i> New Scan
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SSL Certificate Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-certificate"></i> SSL Certificate Analysis
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>SSL Status:</strong></td>
                                    <td>
                                        {% if scan.ssl_valid %}
                                            <span class="badge bg-success">Valid</span>
                                        {% else %}
                                            <span class="badge bg-danger">Invalid</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>SSL Grade:</strong></td>
                                    <td>
                                        <span class="security-grade grade-{{ scan.ssl_grade }}" style="font-size: 1rem; padding: 5px 10px;">
                                            {{ scan.ssl_grade }}
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>Issuer:</strong></td>
                                    <td>{{ scan.ssl_issuer|default:"N/A" }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Expiry Date:</strong></td>
                                    <td>
                                        {% if scan.ssl_expiry %}
                                            {{ scan.ssl_expiry|date:"F d, Y" }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Security Headers Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-shield-alt"></i> HTTP Security Headers
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <strong>HSTS (Strict-Transport-Security):</strong>
                                {% if scan.has_hsts %}
                                    <span class="status-badge status-present">Present</span>
                                {% else %}
                                    <span class="status-badge status-missing">Missing</span>
                                {% endif %}
                            </div>
                            <div class="mb-3">
                                <strong>CSP (Content-Security-Policy):</strong>
                                {% if scan.has_csp %}
                                    <span class="status-badge status-present">Present</span>
                                {% else %}
                                    <span class="status-badge status-missing">Missing</span>
                                {% endif %}
                            </div>
                            <div class="mb-3">
                                <strong>X-Frame-Options:</strong>
                                {% if scan.has_xframe %}
                                    <span class="status-badge status-present">Present</span>
                                {% else %}
                                    <span class="status-badge status-missing">Missing</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <strong>X-XSS-Protection:</strong>
                                {% if scan.has_xss_protection %}
                                    <span class="status-badge status-present">Present</span>
                                {% else %}
                                    <span class="status-badge status-missing">Missing</span>
                                {% endif %}
                            </div>
                            <div class="mb-3">
                                <strong>X-Content-Type-Options:</strong>
                                {% if scan.has_content_type %}
                                    <span class="status-badge status-present">Present</span>
                                {% else %}
                                    <span class="status-badge status-missing">Missing</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance and Technology Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-tachometer-alt"></i> Performance
                    </h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>Response Time:</strong></td>
                            <td>
                                {% if scan.response_time %}
                                    {{ scan.response_time }}ms
                                    {% if scan.response_time < 1000 %}
                                        <span class="badge bg-success">Excellent</span>
                                    {% elif scan.response_time < 3000 %}
                                        <span class="badge bg-warning">Good</span>
                                    {% else %}
                                        <span class="badge bg-danger">Slow</span>
                                    {% endif %}
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>HTTP Status:</strong></td>
                            <td>
                                {% if scan.status_code %}
                                    {{ scan.status_code }}
                                    {% if scan.status_code == 200 %}
                                        <span class="badge bg-success">OK</span>
                                    {% elif scan.status_code >= 400 %}
                                        <span class="badge bg-danger">Error</span>
                                    {% else %}
                                        <span class="badge bg-warning">Warning</span>
                                    {% endif %}
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Server:</strong></td>
                            <td>{{ scan.server_info|default:"Unknown" }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs"></i> Technology Detection
                    </h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>CMS Detected:</strong></td>
                            <td>{{ scan.cms_detected|default:"Unknown" }}</td>
                        </tr>
                        <tr>
                            <td><strong>CMS Version:</strong></td>
                            <td>{{ scan.cms_version|default:"N/A" }}</td>
                        </tr>
                        <tr>
                            <td><strong>Scan Date:</strong></td>
                            <td>{{ scan.scan_date|date:"F d, Y H:i" }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations Section -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-lightbulb"></i> Security Recommendations
                    </h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            {% if not scan.ssl_valid %}
                                <div class="alert alert-danger">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>Critical:</strong> Implement SSL/TLS certificate for secure communication
                                </div>
                            {% endif %}
                            
                            {% if not scan.has_hsts %}
                                <div class="alert alert-warning">
                                    <i class="fas fa-shield-alt"></i>
                                    Add HTTP Strict Transport Security (HSTS) header to prevent protocol downgrade attacks
                                </div>
                            {% endif %}
                            
                            {% if not scan.has_csp %}
                                <div class="alert alert-warning">
                                    <i class="fas fa-code"></i>
                                    Implement Content Security Policy (CSP) header to prevent XSS attacks
                                </div>
                            {% endif %}
                            
                            {% if not scan.has_xframe %}
                                <div class="alert alert-warning">
                                    <i class="fas fa-window-maximize"></i>
                                    Add X-Frame-Options header to prevent clickjacking attacks
                                </div>
                            {% endif %}
                            
                            {% if not scan.has_xss_protection %}
                                <div class="alert alert-info">
                                    <i class="fas fa-bug"></i>
                                    Enable X-XSS-Protection header for additional XSS protection
                                </div>
                            {% endif %}
                            
                            {% if not scan.has_content_type %}
                                <div class="alert alert-info">
                                    <i class="fas fa-file-alt"></i>
                                    Add X-Content-Type-Options header to prevent MIME type sniffing
                                </div>
                            {% endif %}
                            
                            {% if scan.response_time and scan.response_time > 3000 %}
                                <div class="alert alert-info">
                                    <i class="fas fa-clock"></i>
                                    Optimize website performance to reduce response time (currently {{ scan.response_time }}ms)
                                </div>
                            {% endif %}
                            
                            {% if scan.security_score >= 90 %}
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle"></i>
                                    <strong>Excellent!</strong> Your website follows security best practices.
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
